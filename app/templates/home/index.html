{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Alice in Wonderland{% endblock %}</title>
    {% block head %}
    <meta name="csrf-token" content="{{ csrf_token }}"> <!-- CSRF 토큰 추가 -->
    {% endblock %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body id="top" style="margin: 0;">
    <header class="header"> 
        <div class="logo-container">
            <div class="logo">
                <img class="logo-img front" src="{% static 'images/logo_back_black.png' %}" alt="Logo Back">
                <img class="logo-img back" src="{% static 'images/logo_front_black.png' %}" alt="Logo Front">
            </div>
        </div>
        
        <nav class="navbar">
            <a href="#top" class="nav-link">
                <span class="file-tab">HOME</span>
            </a>
            <a href="#about-Alice" class="nav-link">
                <span class="file-tab">ABOUT</span>
            </a>
            <a href="#contact" class="nav-link">
                <span class="file-tab">CONTACT</span>
            </a>            
        </nav>
    </header>

    <div class="qr-wrapper">
        <a href="{% url 'home_qr' %}"><img src="{% static 'images/qr_test.png' %}" alt="QR Code" class="qr-icon" style="width: 3%;"></a>
    </div>      


    <main>
        {% block animation_elements %}
        <div id="fallingContainer" class="falling-container"></div>
        <div id="balloon" class="balloon">당신의 지금 마음은 어떤가요?</div>
        <div id="userBalloon" class="userBalloon">. . .</div>
        {% endblock %}

        {% block input_container %}
        <div class="input-container">
            <textarea id="textBox" class="textBox" placeholder="Message Here"></textarea>
            <button type="button" class="text-button" id="sendButton">
                <img src="{% static 'images/arrow_top.png' %}" style="width: 7%; min-width: 28px;">
            </button>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // CSRF 토큰 가져오기
                const csrfMetaTag = document.querySelector('meta[name="csrf-token"]');
                const csrfToken = csrfMetaTag ? csrfMetaTag.getAttribute('content') : null;

                if (!csrfToken) {
                    console.error("CSRF token not found. Please ensure it is set in the HTML <head>.");
                    return;
                }
                

                const sendButton = document.getElementById("sendButton");
                const textBox = document.getElementById("textBox");

                sendButton.addEventListener("click", () => {
                    const message = textBox.value;

                    fetch('/chatbot/save_message/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken // CSRF 토큰 사용
                        },
                        body: JSON.stringify({ message: message })
                    })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = '/chatbot/'; // 성공 시 리디렉션
                        } else {
                            console.error('Failed to save message');
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            });
            document.addEventListener("DOMContentLoaded", () => {
        // 모든 .nav-link 요소를 선택
                const navLinks = document.querySelectorAll(".nav-link");

                navLinks.forEach(link => {
                    link.addEventListener("click", (event) => {
                        // 기본 앵커 동작 막기
                        event.preventDefault();

                        // 이동할 대상의 ID 추출
                        const targetId = link.getAttribute("href");
                        const targetElement = document.querySelector(targetId);

                        if (targetElement) {
                            // 부드럽게 스크롤
                            targetElement.scrollIntoView({
                                behavior: "smooth",
                                block: "start"
                            });
                        }
                    });
                });
            });


        </script>
        {% endblock %}
    </main>

    <!-- About section -->
    <section id="about-Alice" class="section">
        <div class="about-video-container">
            <!-- 소개영상 넣기 -->
        </div>
        <div class="about-content">
            <h2>ABOUT ALICEchat</h2>
            <p><strong>kcBERT기반으로 사용자 리뷰를 빠르게 파악하여 시각화합니다.</strong></p>
            <p>ALICEchat이 실시간으로 분석해드립니다.</p>
        </div>

<!-- Contact section -->
<section id="contact" class="section footer-section">
    <footer class="footer">
        <div class="footer-content">

        </div>
    </footer>
</section>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="{% static 'js/animation.js' %}"></script>
</body>
</html>
