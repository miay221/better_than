{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Alice{% endblock %}</title>
    {% block head %}
    <meta name="csrf-token" content="{{ csrf_token }}"> <!-- CSRF 토큰 추가 -->
    {% endblock %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body id="top" style="margin: 0;">
    {% block header %}
    <header class="header"> 
        <div class="logo-container">
            <a href="{% url 'home_index' %}">
                <div class="logo">
                    <img class="logo-img front" src="{% static 'images/logo_back.png' %}" alt="Logo Back">
                    <img class="logo-img back" src="{% static 'images/logo_front.png' %}" alt="Logo Front">
                </div>
            </a>  
            <nav class="navbar">
                <ul class="nav-links">
                    <li><a href="{% if request.path == '/home/' %}#about{% else %}{% url 'home_index' %}#about{% endif %}" class="scroll-link">ABOUT</a></li>
                    <li><a href="{% if request.path == '/home/' %}#try{% else %}{% url 'home_index' %}#try{% endif %}" class="scroll-link">TRY SERVICE</a></li>
                    <li><a href="{% if request.path == '/home/' %}#contact{% else %}{% url 'home_index' %}#contact{% endif %}" class="scroll-link">CONTACT</a></li>
                </ul>
            </nav>          
        </div>
        
        
        <div class="qr-wrapper" style="margin-top: 129px; margin-right: 30px;">
            <a href="{% url 'home_qr' %}"><img src="{% static 'images/QR.png' %}" alt="QR Code" class="qr-icon" style="width: 50px;"></a>
        </div>  
    </header>
    {% endblock %}
  

    <main> 
        {% block qr-content %}
        {% endblock %}
        {% block logo-movie %} 
        <!-- about section -->
        <section id="home" style="background-color: black; width: 120vh; margin-top: 15%;">
            <div class="logo-movie-container">
                <div class="logo-movie">
                    <video class="logo-movie-white" autoplay muted loop>
                        <source src="{% static 'images/logo_movie_white_4.mp4' %}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>
            
        </section>
        {% endblock %}

        {% block about-content %}
        <section id="about" style="background-color: black; width: 100%; height: 90vh;">
            <div class="about-content" style="margin-top:80px;">
                <h2 style="color: white; text-align: center;">ABOUT ALICEchat</h2>
                <p style="color: white;"><strong>kcBERT기반으로 사용자 리뷰를 빠르게 파악하여 시각화합니다.</strong></p>
                <p style="color: white;">ALICEchat이 실시간으로 분석해드립니다.</p>
            </div>
        </section>
        {% endblock %}
        
        <section id="try">
            {% block animation_elements %}
            <div id="fallingContainer" class="falling-container">
                <div id="balloon" class="balloon">당신의 지금 마음은 어떤가요?</div>
                <div id="userBalloon" class="userBalloon">. . .</div>
            </div>
            
            {% endblock %}

            {% block input_container %}
            <div class="input-container">
                <textarea id="textBox" class="textBox" placeholder="Message Here"></textarea>
                <button type="button" class="text-button" id="sendButton">
                    <img src="{% static 'images/arrow_top.png' %}" style="width: 7%; min-width: 28px;">
                </button>
            </div>
        </section>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // CSRF 토큰 가져오기
                const csrfMetaTag = document.querySelector('meta[name="csrf-token"]');
                const csrfToken = csrfMetaTag ? csrfMetaTag.getAttribute('content') : null;

                if (!csrfToken) {
                    console.error("CSRF token not found. Please ensure it is set in the HTML <head>.");
                    return;
                }
                
                const sendButton = document.getElementById("sendButton");
                const textBox = document.getElementById("textBox");

                sendButton.addEventListener("click", () => {
                    const message = textBox.value;

                    fetch('/chatbot/save_message/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken // CSRF 토큰 사용
                        },
                        body: JSON.stringify({ message: message })
                    })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = '/chatbot/'; // 성공 시 리디렉션
                        } else {
                            console.error('Failed to save message');
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            });
            document.addEventListener("DOMContentLoaded", () => {
                const logoContainer = document.querySelector(".logo-container");
                const navbar = document.querySelector(".navbar");

                // 초기 상태 숨기기
                navbar.style.opacity = "0";
                navbar.style.transform = "translate(-50%, -50%) translateY(-20px)";
                navbar.style.transition = "opacity 0.3s ease, transform 0.3s ease";
                // navbar.style.marginLeft = "150px";

                // 마우스를 올렸을 때 navbar 나타나기
                logoContainer.addEventListener("mouseenter", () => {
                    navbar.style.opacity = "1";
                    navbar.style.transform = "translate(-50%, -50%) translateY(0)";
                    // navbar.style.marginLeft = "150px";
                });

                // 마우스를 뗐을 때 navbar 숨기기
                logoContainer.addEventListener("mouseleave", () => {
                    navbar.style.opacity = "0";
                    navbar.style.transform = "translate(-50%, -50%) translateY(-20px)";
                    // navbar.style.marginLeft = "150px";

                });
            });

            document.addEventListener("DOMContentLoaded", () => {
                // 현재 페이지 URL에서 fragment ID(#about 등) 추출
                const fragment = window.location.hash.substring(1);
                if (fragment) {
                    const targetElement = document.getElementById(fragment);
                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop - 200; // 섹션 위치 조정
                        window.scrollTo({
                            top: offsetTop,
                            behavior: "smooth"
                        });
                    }
                }

                // 모든 링크 처리
                const links = document.querySelectorAll(".scroll-link");
                links.forEach(link => {
                    link.addEventListener("click", (e) => {
                        e.preventDefault(); // 기본 앵커 동작 방지

                        const href = link.getAttribute("href");
                        if (href.includes("#")) {
                            const [baseUrl, fragment] = href.split("#");
                            if (baseUrl === "" || baseUrl === window.location.pathname) {
                                // 같은 페이지 내 스크롤
                                const targetElement = document.getElementById(fragment);
                                if (targetElement) {
                                    const offsetTop = targetElement.offsetTop - 220;
                                    window.scrollTo({
                                        top: offsetTop,
                                        behavior: "smooth"
                                    });
                                }
                            } else {
                                // 다른 페이지로 이동
                                window.location.href = href;
                            }
                        }
                    });
                });
            });




        </script>
        {% endblock %}
    </main>
</body>
   
{% block footer-section %}
<footer style="height: 100vh; width: 100%; background-color: #e6e6e6;">
    <!-- Contact section -->
    <section id="contact" class="section footer-section">
    
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="{% static 'js/animation.js' %}"></script>
</footer>
{% endblock %}
</html>
